DATA SEGMENT
    
DATA ENDS
STACK SEGMENT STACK
STA DW 100 DUP(?)
STACK ENDS
CODE SEGMENT
ASSUME CS:CODE,DS:DATA,SS:STACK
MOV AX,DATA
MOV DS,AX  ;
START:      ;初始化8251,8251起始地址为200H
MOV DX,202H
MOV AL,0AAH
OUT DX,AL
MOV AL,50H
OUT DX,AL;内部复位操作
NOP
MOV DX,202H ;202H为奇地址
MOV AL,0FAH;模式字
OUT DX,AL
MOV AL,37H;控制字
MOV DX,202H
OUT DX,AL
;cpu1通过18251接受虚拟终端的数据
BEGIN:

MOV DX,202H
IN AL,DX;读状态字
TEST AL,02H;检测RxRDY位
JZ BEGIN
MOV DX,200H;数据口接收数据
IN AL,DX ;接收数据
MOV BX,300H;取数据缓存区地址
MOV [DI+BX],AL;送到缓存区
INC DI;指针加一，存放下一个数
TEST AL,38H;检测是否出错
JNZ ERROR

;直至接收完成
ERROR:
;cpu1通过18255发送数据
MOV DX,216H;初始化8255，8255起始地址210H,控制口地址216H
MOV AL,0A0H ;A口用于输出,方式1
OUT DX,AL
;发送程序
SEND:
MOV AL,0DH;PC6=1,允许中断
MOV DX,216H;
OUT DX,AL
MOV DX,214H;c口地址
IN AL,DX;查询intra引脚
AND AL,08H
JZ SEND
MOV BX,300H;缓存区地址
MOV AL,[DI+BX];DI是字符缓冲区
MOV DX, 210H;从A口发送数据
OUT DX,AL
INC DI ;指针加一

CODE ENDS
END START
ret